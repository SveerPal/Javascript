@extends('admin.app')
@section('title') {{ $title }} @endsection
@section('content')
@php
    $i = 1;
@endphp
    <div class="app-title">
        <div>
            <h1><i class="fa fa-shopping-bag"></i> {{ $title }}</h1>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12">
            <a href="{{ route('admin.products') }}" class="btn btn-primary text-white mr-1 mb-4" type="button">Back To Products</a>
          <div class="tile">
            <div class="tile-body">
              <table class="table table-hover table-bordered" id="sampleTable">
                <tbody>
                    @foreach($products as $product)
                    <tr><th>Image</th>
                        <td>
                            @if ($product->image != null)
                                <img src="{{ asset('storage/uploads/products/'.$product->image) }}" id="logoImg" style="width: 80px; height: 80px;">
                            @endif 
                        </td>
                    </tr>
                     <tr> <th>Name</th><td>{{ $product->name }}</td></tr>
                     <tr><th>Barcode</th><td>{{ $product->barcode }}</td></tr>
                     <tr> <th>Code</th><td>{{ $product->code }}</td></tr>
                    <tr> <th>SKU</th><td>{{ $product->sku }}</td></tr>
                    <tr><th>Company</th><td>{{ $product->companyname }}</td></tr>
                    <tr><th>Category</th><td>{{ $product->catname }}</td></tr>
                    
                    <tr><th>Average of product by user</th><td>@php
$avgg = round($totPro/$totUser);
echo $avgg ;
@endphp
{{ $avgg > 0 ? $avgg :'' }}</td></tr>
                    <!--<tr><th>User</th><td>{{ $product->name }}</td></tr>-->
                   
                    
                    
                    
                    <!--<tr><th>Status</th><td>{{ $product->status }}</td></tr>-->
                    @endforeach
                </tbody>
              </table>
            </div>
          </div>    
          <div class="tile">    
            <div class="tile-body">
                <div class="table-responsive">
                  <table class="table table-hover table-bordered" id="sampleTable2">
                    <thead>
                        <tr> 
                            <th>Sr No</th>
                            <th>User</th>
                            <th>Tags</th>
                            <th>Shipper Box</th>
                            <th>Graphic Box</th>
                            <th>Value Paid</th>
                            <th>Value Sold</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach($productsuserlist as $prdtuserlist)
                        <tr> 
                            <td id="{{ $prdtuserlist->id }}"> {{ $i++ }}</td>
                            <td>{{ $prdtuserlist->full_name }}</td>
                            <td>{{ $prdtuserlist->tag_id }}</td>
                            <td>{{ $prdtuserlist->shipperbox }}</td>
                            <td>{{ $prdtuserlist->graphicbox }}</td>
                            <td>{{ $prdtuserlist->value_paid }}</td>
                            <td>{{ $prdtuserlist->value_sold }}</td>
                            <td>
                                <a @if ($prdtuserlist->status != 1) href="{{ route('admin.products.user-product-statuschange',['id'=>$prdtuserlist->id,'status'=>1]) }}" @endif
                                class="btn btn-primary text-white btn-sm" type="button" title="Approved" @if ($prdtuserlist->status != 1) style="opacity:0.5" @endif>
                                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                                </a>
                                <a @if ($prdtuserlist->status != 0) href="{{ route('admin.products.user-product-statuschange',['id'=>$prdtuserlist->id,'status'=>0]) }}" @endif
                                    class="btn btn-warning text-white btn-sm" type="button" title="Unapproveed" @if ($prdtuserlist->status != 0) style="opacity:0.5" @endif>
                                    <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                                </a>
                                <a @if ($prdtuserlist->status != 2) href="{{ route('admin.products.user-product-statuschange',['id'=>$prdtuserlist->id,'status'=>2]) }}"  @endif
                                class="btn btn-danger text-white btn-sm" type="button" title="Rejected"  @if ($prdtuserlist->status != 2) style="opacity:0.5" @endif>
                                    <i class="fa fa-ban" aria-hidden="true"></i> 
                                </a>
                            </td>
                            
                            <td>
                                <span style="display:none" id="{{ $prdtuserlist->id }}">
                                    <table class="table table-hover table-bordered" >
                                    <tbody>
                                    <tr> <th>Product Type</th><td>{{ $prdtuserlist->product_type }}</td></tr>
                                    <tr> <th>Scale</th><td>{{ $prdtuserlist->scale }}</td></tr>
                                    <tr> <th>Active Collection</th><td>{{ $prdtuserlist->active_collection }}</td></tr>
                                    <tr> <th>Rating</th><td>{{ $prdtuserlist->rating }}</td></tr>
                                    <tr> <th>Comment</th><td>{{ $prdtuserlist->comment }}</td></tr>
                                    <tr><th>What Missing</th><td>{{ $prdtuserlist->figure_complete }}</td></tr>
                                    <tr><th>Figure Complete</th><td>{{ $prdtuserlist->what_missing }}</td></tr>
                                    <tr><th>Image</th>
                                        <td>
                                            @if ($prdtuserlist->image != null)
                                                <img src="{{ asset('storage/uploads/products/'.$prdtuserlist->image) }}" id="logoImg" style="width: 80px; height: 80px;">
                                            @endif 
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>Gallery</th>
                                        <td>
                                            @if ($prdtuserlist->gallery != null)
                                                @foreach(explode(',',$prdtuserlist->gallery) as $row)
                                                    <img src="{{ asset('storage/uploads/products/'.$row) }}" id="logoImg" style="width: 80px; height: 80px;">
                                                @endforeach
                                            @endif 
                                        </td>
                                    </tr>
                                    </tbody>
                                    </table>
                                </span>
                                <a class="btn btn-primary btn-sm text-white" href="{{ route('admin.products.user-product-view',['product_id'=>$prdtuserlist->product_id,'id'=>$prdtuserlist->id]) }}" >
                                    <i class="fa fa-eye" aria-hidden="true"></i> 
                                </a>
                                <a class="btn btn-warning btn-sm text-white" href="{{ route('admin.products.user-product-edit',['product_id'=>$prdtuserlist->product_id,'id'=>$prdtuserlist->id]) }}">
                                    <i class="fa fa-pencil" aria-hidden="true"></i> 
                                </a>
                                @if(!$prdtuserlist->admin_id)
                                    <form id="myForm{{ $prdtuserlist->id }}">
                                        @csrf
                                        <input type="hidden" value="{{ $prdtuserlist->id }}" name="productUserId">
                                    </form>
                                    <a class="btn btn-info btn-sm text-white copytoadmin" productUserId="{{ $prdtuserlist->id }}" href="javascript:void(0)" ><i class="fa fa-files-o"></i></a>
                                @endif
                                
                            </td>
                        </tr>
                        <!--<tr><th>Status</th><td>{{ $product->status }}</td></tr>-->
                        @endforeach
                    </tbody>
                  </table>
                </div>
            </div>
          </div>
        </div>
    </div>
@endsection
@push('scripts')
    <script type="text/javascript" src="{{ asset('backend/js/plugins/jquery.dataTables.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('backend/js/plugins/dataTables.bootstrap.min.js') }}"></script>
    <script type="text/javascript">$('#sampleTable2').DataTable();</script>
     
    <script>
    
    document.querySelector(".copytoadmin").addEventListener('click',function(){
        
   
        
        let productUserId=this.getAttribute("productUserId");
        var data = new FormData($("#myForm"+productUserId)[0]);
       swal({
            title: "Are you sure?",
            text: "You will not be able to recover this imaginary file!",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Yes, delete it!",
            cancelButtonText: "No, cancel plx!",
            closeOnConfirm: false,
            closeOnCancel: true
        }, function (isConfirm) {
            if (isConfirm) { 
                $.ajax({
                    type : "post",   
                    url:"/admin/products/user-product-copy-to-admin",
                    data:data,
                    cache:false,
                    contentType: false,
                    processData: false,
                    dataType:'json',
                    beforeSend : function() {
                        
                    },
                    success : function(response) {
                        // console.log(response);
                        if(response.sts==1){
                            this.remove();
                            //setTimeout(function(){
                                swal("Success!",response.msg , "success");
                            //},50)    
                        }else if(response.sts=2){
                            //setTimeout(function(){
                                swal("Info!",response.msg , "info");
                            //},50)    
                        }
                    },
                    error: function(requestObject, error, errorThrown) {
                        //setTimeout(function(){
                         swal("Error!",errorThrown , "error");
                        //},50) 
                          jQuery('.msg').html('<div class="alert alert-danger" role="alert">'+errorThrown+'</div>');
                    }
                }); 
            }
        });
        
    })
    
        function showModel(id){
            jQuery('.modal-body').html(jQuery('#'+id).html())
        }
        $("#myModal").on("hidden.bs.modal", function () {
            jQuery('.modal-body').html('')
        });
    </script>
@endpush
<!-- Modal -->
<div class="modal fade  bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Details<!--Modal title--></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
       
      </div>
    </div>
  </div>
</div>